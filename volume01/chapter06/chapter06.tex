% !TEX useAlternatePath
% !TEX useConTeXtSyncParser

\startcomponent chapter06
\project project_world
\product prd_volume01

\doifmode{*product}{\setupexternalfigures[directory={chapter06/images}]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\startchapter[title=The Rational Mechanics of Lagrange and Hamilton,reference=ch:Hamilton]
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\placefigure[margin,none]{}{\small
	\startalignment[flushleft]
The theoretical development of the laws of motion of bodies is a problem of such interest and importance, that it has engaged the attention of all the most eminent mathematicians, since the invention of dynamics as a mathematical science by \scaps{Galileo}, and especially since the wonderful extension which was given to that science by \scaps{Newton}. Among the successors of those illustrious men, \scaps{Lagrange} has perhaps done more than any other analyst, to give extent and harmony to such deductive researches, by showing that the most varied consequences respecting the motions of systems of bodies may be derived from one radical formula; the beauty of the method so suiting the dignity of the results, as to make of his great work a kind of scientific poem\dots.
%But the science of force, or of power acting by law in space and time, has undergone already another revolution, and has become already more dynamic, by having almost dismissed the conceptions of solidity and cohesion, and those other material ties, or geometrically imaginably conditions, which \scaps{Lagrange} so happily reasoned on, and by tending more and more to resolve all connexions and actions of bodies into attractions and repulsions of points: and while the science is advancing thus in one direction by the improvement of physical views, it may advance in another direction also by the invention of mathematical methods.
And the method proposed in the present essay, for the deductive study of the motions of attracting or repelling systems, will perhaps be received with indulgence, as an attempt to assist in carrying forward so high an inquiry.%\autocite[p.48]{Galileo1610}
	\stopalignment
	\startalignment[flushright]
	{\it On A General Method In Dynamics}\\
	{\sc William Rowan Hamilton}\\
	1805--1865
	\stopalignment
}

\Initial{I}{n \booktitle{Hydrodynamica} and his other works,} Daniel Bernoulli applied sharp physical insights to practical problems – pipes, fountains, pumps, and other useful machines. Everyone else was going in other directions.

Engineers developed and applied methods specific to specialized applications without looking for broadly applicable physical principles. This practical approach was incredibly successful. Eighteenth century engineers launched the industrial revolution, building powerful working engines decades before physicists could explain them.

Physicists largely ignored the engines, focusing their attention on abstract problems in pure mechanics – planetary motion, spinning tops, and jointed pendulums. These problems had little practical value, but they inspired rapid advances in applied mathematics.
Leonhard Euler (a close friend of Danial Bernoulli), adapted and expanded Newton's methods to solve many new types of problems. Other physicists introduced new principles – like energy conservation – to solve problems in entirely new ways. These advances produced a rather confusing patchwork of methods and principles.

Joseph-Louis Lagrange sought to replace the patchwork with a single method that could be applied to any problem in mechanics. He delivered his synthesis in \booktitle{Mécanique Analytique}, published in 1788, almost exactly a century after Newton's \booktitle{Principia}. Lagrange describes his intent in the monumental work's preface.

\startblockquote
There already exist several treatises on mechanics, but the purpose of this one is entirely new. I propose to condense the theory of this science and the method of solving the related problems to general formulas whose simple application produces all the necessary equations for the solution of each problem. %I hope that my presentation achieves this purpose and leaves nothing lacking.
%In addition, this work will have another use. The various principles presently available will be assembled and presented from a single point of view in order to facilitate the solution of the problems of mechanics.
\stopblockquote

Lagrange's single method could be used to solve any mechanical system, from Galileo's falling rock and interrupted pendulum to Kepler's planetary orbits and Mersenne's mysterious musical string. 

Lagrange found the directional information we need not in the kinetic energy $K$, but hidden in the potential energy $U$. His equation for converting Daniel Bernoulli's potential energy into Newtons force contains a virtual displacement $\partial x$.
\startformula
	F\sub{Newton} = -\frac{\partial U}{\partial x}
\stopformula
The virtual displacement's direction can gives us directional information from $U$. 
Remember that $\partial U$ is the small virtual change in the potential energy due to the small virtual displacement $\partial x$.

\section{Derivatives give a function's slope}


%If students could learn these, it might help a great deal when we try to do $\partial U/\partial x$ and $\partial H/\partial p$ in chapters 5 and 6. 

%\section{Instantaneous rate of change is a derivative}
Instantaneous velocity is defined in terms of a small change in position over a small change in time
\startformula
	v = \frac{dx}{dt}
\stopformula
This is the slope on the position vs.\ time graph, and it can be found at a specific moment by drawing a tangent line. The tangent line method is nice, but it would be great if we could find the instantaneous velocity for every moment – without having to draw a million tangent lines. This can be done with the \keyterm{derivative}.

The derivative takes one function and produces a second function that is everywhere equal to the first function's slope. For example, if the first function is an object's position as a function of time, then that function's derivative is the object's velocity as a function of time. In mathematical language, the object's position $x$ is a function of time and that function's derivative is written $\frac{d}{dt}x$. This derivative is the instantaneous velocity $v$.
\startformula
v = \ddt x
\stopformula
This formula looks very similar to the instantaneous velocity definition above. However, the definition above was a ratio of two small numbers find the instantaneous velocity at a specific moment. The derivative $\ddt$ takes the function $x$ and gives a new function $v$. The examples below will show how the derivative $\ddt$ acts on the function to its right and replaces it with a new function.

You will be able to perform all of the derivatives you need with just four rules.
First, the derivative of  a constant function (like $x = 3\units{m}$) is \emph{zero} because the rate of change is zero. This is the \keyterm{constant rule}.
\startuseMPgraphic{graph::xconst} % I'd like to add minor ticks, 0.667mm long.
	path xpos;
	xpos := (0,3) -- (4.4,3);
draw begingraph(4.4cm,4cm);
	setrange(origin, 4.4, 4);
	for y=0, 1, 2, 3, 4 :
		itick.lft(formatted("$@g$", y), y);
		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
	endfor
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("$x$ (m)") rotated 90, OUT);
	glabel.bot(textext("$t$"), OUT);
	gdraw(xpos) withpen pencircle scaled 0.8pt;
	glabel.top("$x=3\units{m}$",0.5);
	glabel.bot("$v=0$",0.5);
endgraph;
\stopuseMPgraphic
\startplacefigure[location=margin, reference=fig:xconst, title={The function $x=3\units{m}$ is a constant. The velocity $v=\ddt x$ is zero at all times.}]
\small\reuseMPgraphic{graph::xconst}
\stopplacefigure
\startformula
	\ddt \text{const.} = 0
\stopformula
For example, the function $x=3\units{m}$ is shown in \in{figure}[fig:xconst]. The velocity $v$ is the slope, given by the derivative, which is zero.

The next rule gives the derivative of functions that are powers of $t$, like $t^2$, $t^{-1}$, or $t^1 = t$. The derivatives of these powers are given by the \keyterm{power rule}. 
\startformula
	\ddt t^n = nt^{n-1}
\stopformula

For a function that is a sloped straight line, like $x = t$, the derivative is the line's slope. (We are ignoring units \emph{briefly}.)
The slope is the same at all times, so the derivative is the same at all times, as in \in{figure}[fig:xlin]. This slope is given by the power rule with $n=1$. 
\startuseMPgraphic{graph::xlin} % I'd like to add minor ticks, 0.667mm long.
	path xpos;
	xpos := (0,0) -- (5,5);
draw begingraph(4.4cm,4.4cm);
	setrange(origin, 4.4, 4.4);
	for y=auto.y:
		itick.lft(formatted("$@g$", y), y);
		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
	endfor
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("$x$"),OUT);
	glabel.bot(textext("$t$"), OUT);
	gdraw(xpos) withpen pencircle scaled 0.8pt;
	gdotlabel.ulft("$x=1$" , 0.2);
	glabel.bot("$v=1$" , 0.2) rotatedaround(point 0.2 of xpos, 45);
	gdotlabel.ulft("$x=2$" , 0.4);
	glabel.bot("$v=1$" , 0.4) rotatedaround(point 0.4 of xpos, 45);
	gdotlabel.ulft("$x=3$" , 0.6);
	glabel.bot("$v=1$" , 0.6) rotatedaround(point 0.6 of xpos, 45);
	gdotlabel.ulft("$x=4$" , 0.8);
	glabel.bot("$v=1$" , 0.78) rotatedaround(point 0.78 of xpos, 45);
endgraph;
\stopuseMPgraphic
\startplacefigure[location=margin, reference=fig:xlin, title={The function $x=t$ is a straight line. The velocity $v=\ddt x$ is $1$ at all times.}]
\small\reuseMPgraphic{graph::xlin}
\stopplacefigure
\startformula
	\ddt t = \ddt t^1 = 1t^{1-1} = 1t^0 = 1
\stopformula
For a parabola, like $x = t^2$, the slope is different at different locations, so the derivative is a new function. \in{Figure}[fig:xquad] shows the function $x=t^2$ and some slopes, which can be found using the power rule with $n=2$.
\startuseMPgraphic{graph::xquad} % I'd like to add minor ticks, 0.667mm long.
	path xpos;
	xpos := (-3,9) ..controls (-1,-3) and (1,-3).. (3,9);
draw begingraph(4.6cm,4.8cm);
	setrange(-2.3, -0.4, 2.3, 4.4);
	for y=auto.y:
		itick.lft(formatted("$@g$", y), y);
		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
	endfor
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("$x$"),OUT);
	glabel.bot(textext("$t$"), OUT);
	gdraw(xpos) withpen pencircle scaled 0.8pt;
	gdotlabel.rt("$x=4$" , 1/6);
	glabel.lrt("$v=-4$" , 1/6) rotatedaround(point 1/6 of xpos, -76);
	gdotlabel.urt("$x=1$" , 1/3);
	glabel.bot("$v=-2$" , 1/3) rotatedaround(point 1/3 of xpos, -63.4);
	gdotlabel.top("" , 0.5) ;
	glabel.top("$x=0$" , 0.5) shifted (0, 0.1);
	glabel.bot("$v=0$" , 0.5) shifted (0, 0.05);
	gdotlabel.ulft("$x=1$" , 2/3);
	glabel.bot("$v=2$" , 2/3) rotatedaround(point 2/3 of xpos, 63.4);
	gdotlabel.lft("$x=4$" , 5/6);
	glabel.llft("$v=4$" , 5/6) rotatedaround(point 5/6 of xpos, 76);
endgraph;
\stopuseMPgraphic
\startplacefigure[location=margin, reference=fig:xquad, title={The function $x=t^2$ is not straight. The velocity $v=\ddt x = 2t$ changes with time.}]
\small\reuseMPgraphic{graph::xquad}
\stopplacefigure
\startformula
	\ddt t^2 = 2t^{2-1} = 2t^1 = 2t
\stopformula
The power rule works for any power, including negative powers (like $x = 1/t = t^{-1}$) and fractional powers (like $x = \sqrt{t} = t^{\onehalf}$).

\startexample[ex:DerivativeConstantV]
Find $\ddt t^3$.
\startsolution
Use the power rule with $n=3$.
\startformula
	\ddt t^3 = 3 t^{3-1} = 3t^2
\stopformula
\stopsolution
\stopexample
\startexample[ex:DerivativeConstantV]
Find $\ddt \sqrt{t}$.
\startsolution
Use the power rule with $n=\onehalf$.
\startformula
	\ddt \sqrt{t} = \ddt t^\onehalf = \onehalf\,t^{\onehalf-1} = \onehalf\,t^{-\onehalf} = \frac{1}{2\sqrt{t}}
\stopformula
\stopsolution
\stopexample

The third rule says that when a function is multiplied by some constant, its slope is multiplied by the same constant. This constant multiplier is called a \emph{coefficient}. For any function of time $f$ muliplied by a coefficient $a$ we use the \keyterm{coefficient rule}.
\startformula
	\ddt af  = a \ddt f
\stopformula
On the left, the derivative is acting on $af$. On the right the derivative is only acting on $f$. We often say that we have pulled the constant $a$ out of the derivative.
The coefficient $a$ will typically have units. (Yay, units!) For example, if an object's momentum is given by the formula $p = (14\units{kg\.m/s^3})\,t^2$, we can find the force, which is the derivative of momentum.
\startformula
	F = \ddt p
		= \ddt (14\units{kg\.m/s^3})\,t^2
		= (14\units{kg\.m/s^3}) \ddt t^2
		= (28\units{kg\.m/s^3})\,t 
\stopformula
In the third expression, the derivative is acting on $(14\units{kg\.m/s^3})\,t^2$. We pull the constant $(14\units{kg\.m/s^3})$ out of the derivative to get the fourth expression, where the derivative is acting on $t^2$.  We then find $\ddt t^2$ using the power rule with $n=2$.

The fourth and final rule is for functions added together. The slope of the sum is equal to the sum of the slopes. For any two functions of time $f$ and $g$ we use the \keyterm{sum rule}.
\startformula
	\ddt (f+g) = \ddt f + \ddt g
\stopformula
For example, if an object's vertical position is given by the formula $y = (12\units{m/s})\,t - (4.9\units{m/s^2})\,t^2$, we can find the vertical component of its velocity.
\startformula\startmathalignment
\NC	v_y = \ddt y	
		\NC = \ddt \left[(12\units{m/s})\,t - (4.9\units{m/s^2})\,t^2\right]	\NR
\NC		\NC = \ddt (12\units{m/s})\,t - \ddt (4.9\units{m/s^2})\,t^2		\NR
\NC		\NC = (12\units{m/s})\ddt t - (4.9\units{m/s^2}) \ddt t^2			\NR
\NC		\NC = (12\units{m/s}) - (9.8\units{m/s^2})\,t						\NR
\stopmathalignment\stopformula
We used the sum rule, then the coefficient rule, and finally the power rule (twice) to find the velocity.

The derivative can be used on any coordinate ($y$, $z$, $\theta$) to find the corresponding component of the velocity ($v_y$, $v_z$, $\omega$). The derivative can also be used to find any component of force from the corresponding component of the momentum.

There are more derivative rules for more complicated functions, but the four rules above are all you need for this physics course. 

%We only need three rules for working with rates of change. In the rules below, $f$ and $g$ are functions of time, while $a$ and $n$ are constants.
%\startformula\startmathalignment
%\NC \ddt(af)	\NC = a \ddt f		\NR
%\NC \ddt (f + g)	\NC = \ddt f + \ddt  g	\NR
%\NC \ddt t^n	\NC = n t^{n-1}		\NR
%\stopmathalignment\stopformula
%
%
%There are two general derivative rules that we do not need: the product rule and the chain rule. These are both more difficult to understand and use than the rules above. We could use the product rule to get the power rule, but it that derivation probobaly doesn't bring much benefit.
%The chain rule is could be used for simple harmonic motion, $x = A \sin(t/2\pi T)$, but we don't need the instantaneous velocity of SHO at all times, just the maximum speed. There are, of course, many formulas for derivatives of specific functions (trig, exp, log, etc.), but I think we only need powers.

\startexample[ex:DerivativeConstantV]
An object's position $x$ at time $t$ is given by the equation
\startformula
	x = x_0 + v_0 t
\stopformula
Where $x_0$ and $v_0$ are constants. ($x_0$ is the object's starting position). Use the derivative rules to find the object's velocity $v$ at any time $t$.

\startsolution
We start with the instantaneous velocity definition $v=\frac{d}{dt}x$, and apply the rules.
\startformula\startmathalignment
\NC v = \ddt x
		\NC = \ddt (x_0 + v_0t)		\NR
\NC		\NC = \ddt x_0 + \ddt v_0t	\NR
\NC		\NC = 0 + v_0\ddt t			\NR
\NC		\NC = v_0					\NR
\stopmathalignment\stopformula
At any time $t$, the instantaneous velocity $v$ is the constant $v_0$. This is constant velocity motion, also called uniform motion.
\stopsolution
\stopexample


\startexample[ex:DerivativeConstantF]
An object's momentum $p$ at time $t$ is
\startformula
	p = p_0 + F_0t.
\stopformula
where $p_0$ and $F_0$ are constants. ($p_0$ is the object's starting momentum). Find the force $F$ acting on the object at any time $t$.

\startsolution
Force is the rate of momentum change: $F=\frac{d}{dt}p$.
\startformula
	F = \ddt p = \ddt (p_0 + F_0 t) = F_0
\stopformula
The force $F$ is the constant $F_0$. This is constant force motion.
\stopsolution
\stopexample


\startexample[ex:DerivativeConstantF]
An object's position $x$ at time $t$ is given by the equation
\startformula
	x = x_0 + v_0 t + \half a_0 t^2
\stopformula
Where $x_0$ and $v_0$ and $a_0$ are constants. Find the object's velocity $v$ and the force acting on the object at any time $t$.
\startsolution
We start with the instantaneous velocity definition $v=\ddt x$, and apply the rules. Notice what happens to the \onehalf\ in the final term.
\startformula\startmathalignment
\NC v = \ddt x
		\NC = \ddt (x_0 + v_0t + \half a_0 t^2)		\NR
\NC		\NC = \ddt x_0 + \ddt v_0t  + \half a_0 t^2	\NR
\NC		\NC = 0 + v_0\ddt t	 + \half a_0 \ddt t^2	\NR
%\NC		\NC = v_0 + \half a 2 t				\NR
\NC		\NC = v_0 + a_0t							\NR
\stopmathalignment\stopformula
This velocity is not constant – the object is accelerating. (The object's initial velocity is $v_0$.) The momentum is also changing.
\startformula 
	p = mv = m(v_0 + a_0 t)
\stopformula	
Using the derivative rules we find the force $F$ acting on the object at any time $t$.
\startformula
	F = \ddt p = \ddt m(v_0 + a_0t) = m\ddt (v_0 + a_0t) = ma_0
\stopformula
At any time $t$, the force $F$ is 
\startformula
	F = ma_0
\stopformula
Since $m$ and $a_0$ are constants, this is constant force motion. The constant force $F$ acting on the object causes the object's constant acceleration $a_0$.
\stopsolution
\stopexample

%\section{Other problem ideas}
%Resistance forces are often proportional to velocity, resulting in function with negative powers. Find the force acting on an objects whose velocity is $v = c/t$. Find the force acting on an object whose position is $x = x_0 - c/t$ (The object approaches $x_0$, but never quite reaches it due to the slowing.)
%
%All of this works with any coordinates, so it would be good to have examples with $y$ and $\theta$ as functions of $t$. Several coordinates can be part of the same problem, giving velocity and force components, as well as angular velocity and torque.
%
%I considered problems using $F = \frac{d}{dx}H$, but these did not seem to provide a useful bridge from time derivatives to the partial derivatives below. In fact, it seems to blur the distinction in counter productive ways.

%\section{Local slopes are partial derivatives}
%
%Finding a pendulum's equations of motion symbolically requires the derivative of the potential energy $U = -mgR\cos(\theta)$. We don’t need chain rule in that case, but we do need $\frac{d}{d\theta}\cos(\theta) = -\sin(\theta)$. However, this problem is easy to solve with a diagram, which is probably better than doing it symbolically anyway.

\startuseMPgraphic{graph::BoxEarthGravU} % I'd like to add minor ticks, 0.667mm long.
vardef U =
	path p;
		for x = 5 step 0.1 until 40:
			y := -11.90/x; % lua.mp.morse(x);
			augment.p(x,y);
		endfor;
	p enddef;
draw begingraph(4cm,4cm);
	setrange(0,-2, 40, 0);
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("Energy ($\sci{8}\units{J}$)") rotated 90,OUT);
	glabel.bot(textext("$r$ ($\sci{6}\units{m}$)"), OUT);
	gdraw(U) withpen pencircle scaled 0.8pt;
	glabel.lrt("$U$",140);
	glabel(mydot,(80));
	glabel(mydot,(210));
	glabel(mydot,(340));
	gfill(unitsquare xyscaled (6.37,-2)) withcolor "lightgray";
	gdraw((6.37,0) -- (6.37,-2)) withpen pencircle scaled 0.8pt;
	for y=0 step -0.5 until -2:%auto.y:
		itick.lft(formatted("$@g$", y), y);
		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
	endfor
endgraph shifted (0,-5cm);
  pickup pencircle scaled 0.8pt ;
  draw externalfigure "EarthEratosthenes.png" scaled 0.127 shifted (-6.37mm,-6.37mm) ;
  draw fullcircle scaled 12.74mm;
  drawarrow (13mm,0) -- (-0.5mm,0);
    dotlabel.ulft  ("", (13mm,0)) ;
  drawarrow (26mm,0) -- (22.625mm,0);
    dotlabel.top  ("$F\sub{Newton}$", (26mm,0)) ;
  drawarrow (39mm,0) -- (37.5mm,0);
    dotlabel.llft  ("", (39mm,0)) ;
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:BoxEarthGravU, title={The gravitational force on a $3.0\units{kg}$ object at different distances from Earth (top). The potential energy of of $3.0\units{kg}$ object in Earth’s vicinity (bottom). The potential is not shown for locations inside Earth (the gray region).}]
\small\reuseMPgraphic{graph::BoxEarthGravU}
\stopplacefigure

The energy graph in \in{figure}[fig:BoxEarthGravU] also shows the gravitational force. To see it, we must use Lagrange's insight. Above the energy graph I have drawn Earth and the gravitational force on the box at three different distances from Earth. These distances are also marked on the energy graph. The gravitational potential energy's slope is positive everywhere, so the gravitational force, $F\sub{Newton} = -\partial U/\partial x$, is negative everywhere – pulling the box back toward Earth. This is similar to the right side of \in{figure}[fig:BlockSHONewton], where the spring potential energy's positive slope leads to a negative spring force – pulling the block back toward the center. The spring's potential energy gets steeper as the spring is stretched, leading to a spring force that increases with distance. The gravitational potential energy does the opposite, getting less steep as the box is moved farther from Earth, leading to a gravitational force that decreases with distance. This is why the force arrows \in{figure}[fig:BoxEarthGravU] get smaller farther from Earth.

The gravitational force can be calculated from the gravitational potential energy formula. 
\startformula\pagereference[eq:UniversalGrav]
	F\sub{Newton} = -G\frac{mM}{r^2},
\stopformula
(This calculation requires some basic calculus, which you do not need to know. If you do know calculus, watch out for three minus signs!) This formula is \keyterm{Newton's universal law of gravitation}, and it can be used to find the gravitational force between any two objects. It looks almost identical to the formula for gravitational potential energy, but the denominator is $r^2$ instead of $r$. The $r^2$ in the denominator tells us that the force is very small when the distance is large. (You already knew that from looking at the energy graph – no calculus needed!)

Newton presented his universal law of gravitation in the \booktitle{Principia}, along with his laws of motion, long before D.~Bernoulli studied gravitational potential energy. D.~Bernoulli did the calculus calculation the other direction,  finding his formula for gravitational potential energy from Newton's universal law of gravitation.

The gravitational force is often written $F = -mg$, where $g$ is the strength of the \keyterm{gravitational field}.
\startformula
	g = G\frac{M}{r^2},
\stopformula
Here on Earth's surface, $g=9.8\units{m/s^2}$. The gravitational field gets weaker with distance because of the $r^2$ in the denominator. The gravitational field formula can be used to find $g$ any distance from any celestial object. Objects with larger mass $M$ have stronger gravitational fields. Less massive objects's, like the Moon have weaker gravitational fields.



If there are more coordinates, like $y$ for the cannon ball, then there are more directions for the virtual displacement. Lagrange found that he could get each component of Newton's force by choosing the correct direction for the virtual displacement. He found the $x$-component of Newton's force with a virtual displacement in the $x$-direction, the $y$-component with a virtual displacement in the $y$-direction, and so on for all the coordinates of the system. (These virtual displacements do not actually happen in the physical system, so Lagrange was free to imagine different virtual displacements to get the force's different components.)





\section{Lagrange's step in the right direction}



\startbuffer[cannondx]
\draw[shade, ball color = black!60] (0,0) circle[radius=.25cm]; % Ball
\filldraw (0,0) circle[radius=.02cm]; % Ball cm
\draw[thick,->] (-2.5,-1)--node[above]{$x$} ++(1,0); % x-axis
\draw[opacity=0] (-2.5,-1)-- ++(5,0); % x-floor to get the ball centered
\draw[thick,->] (-2.5,-1)--node[right]{$y$} +(0,1); % y-axis
\draw[thick,->] (-0.5,0)--(0.5,0)node[right]{$\partial x$} ; % pf
\stopbuffer

\marginTikZ{}{cannondx}{A small horizontal virtual displacement $\partial x$ produces no change in the gravitational potential energy. $\partial U = 0$. } % vskip, name, caption
For the cannon ball, a small virtual displacement $\partial x$ in the $x$-direction is a horizontal displacement (shown in \in{figure}[fig:cannondx]), which does not change the cannon ball's gravitational potential energy at all. For this horizontal displacement, $\partial U = 0$. Lagrange's equation gives the $x$-component of the gravitational force. (I will drop \quotation{Newton} from the suffix for the remainder of this section.)
\startformula
	F_{x} = -\frac{\partial U}{\partial x}
		= -\frac{0}{\partial x}
		= 0
\stopformula
The gravitational force's $x$-components is zero, as we knew. A small virtual displacement $\partial y$ in the $y$-direction is a vertical displacement (shown in \in{figure}[fig:cannondy]), which does change the cannon ball's gravitational potential energy. For this vertical displacement, $\partial U = mg\partial y$, which leads to the $y$ component of the gravitational force.
\startbuffer[cannondy]
\draw[shade, ball color = black!60] (0,0) circle[radius=.25cm]; % Ball
\filldraw (0,0) circle[radius=.02cm]; % Ball cm
\draw[thick,->] (-2.5,-1)--node[above]{$x$} ++(1,0); % x-axis
\draw[opacity=0] (-2.5,-1)-- ++(5,0); % x-floor to get the ball centered
\draw[thick,->] (-2.5,-1)--node[right]{$y$} +(0,1); % y-axis
\draw[thick,->] (0,-0.5)--(0,0.5)node[above]{$\partial y$} ; % pf
\stopbuffer

\marginTikZ{}{cannondy}{A small vertical virtual displacement $\partial x$ increases the gravitational potential energy. $\partial U = mg\partial y$.} % vskip, name, caption
\startformula
	F_{y} = -\frac{\partial U}{\partial y}
		= -\frac{mg\cancel{\partial y}}{\cancel{\partial y}}
		= -mg
\stopformula
\startbuffer[cannonForce]
\draw[shade, ball color = black!60] (0,0) circle[radius=.25cm]; % Ball
\filldraw (0,0) circle[radius=.02cm]; % Ball cm
\draw[thick,->] (-2.5,-2)--node[above]{$x$} ++(1,0); % x-axis
\draw[opacity=0] (-2.5,-2)-- ++(5,0); % x-floor to get the ball centered
\draw[thick,->] (-2.5,-2)--node[right]{$y$} +(0,1); % y-axis
\draw[thick,->] (0,0)--node[right]{$\vec F = \components{0,-mg}$} ++(0,-2); % pf
\stopbuffer

\marginTikZ{\vskip 0.5cm}{cannonForce}{The gravitational force on the cannon ball, with components found using Lagrange's equation.} % vskip, name, caption
\noindent
The gravitational force's $y$-component is $-mg$, again agreeing with what we knew. These two components give the gravitational force vector shown in \in{figure}[fig:cannonForce].
While potential energy itself does not have a direction, Lagrange's procedure produces the force vector, which does have a direction.

Keeping track of the different virtual changes $\partial U$ due to the different virtual displacements $\partial x$ and $\partial y$ can get confusing, but Lagrange has good news. The ratios $\partial U\!/\partial x$ and $\partial U\!/\partial y$ can be easily found using the same derivative rules that we learned for rates of change (like $v = dx/dt$). When computing $\partial U\!/\partial x$ we keep $y$ constant. When computing $\partial U\!/\partial y$ we keep $x$ constant.

\startexample[ex:CannonDirivaties]
Use Lagrange's equation and the derivative rules to find the force components $F_x$ and $F_y$ on the cannon ball.
\startsolution
The $x$ component of the force is given by Lagrange's equation with a virtual displacement in the $x$-direction.
\startformula
	F_x = -\frac{\partial U}{\partial x} = -\ppx U = -\ppx mgy = 0
\stopformula
When calculating $\partial U\!/\partial x$ we keep $y$ constant, which makes $mgy$ constant. The derivative of a constant is zero.

The $y$ component of the force is given by Lagrange's equation with a virtual displacement in the $y$-direction.
\startformula
	F_y = = -\frac{\partial U}{\partial y} = -\ppy U = -\ppy mgy =  -mg\ppy y = -mg
\stopformula
After pulling the coefficient $mg$ out of the derivative, we compute $\ppy y$ using the power rule with $n=1$.
\stopsolution
\stopexample

The ratios $\partial U\!/\partial x$ and $\partial U\!/\partial y$ are called partial derivatives of $U$ because we compute them allowing only one part of our coordinates (either $x$ or $y$) to change while other parts are kept constant. Computing partial derivatives is much easier than dealing with many tiny virtual displacements. As a result, Lagrange replaced many diagrams with partial derivatives.

Lagrange's equations for the components of Newton's forces were totally unlike Newton's own methods for working with forces. Newton's \booktitle{Principia} is full of diagrams. Newton's calculations are done with graphical methods, and equations are few. In the preface to his \booktitle{Mécanique Analytique}, Lagrange explains his analytical method.
\startblockquote
No figures will be found in this work. The methods I present require neither constructions nor geometrical or mechanical arguments, but solely algebraic operations subject to a regular and uniform procedure. Those who appreciate mathematical analysis will see with pleasure mechanics becoming a new branch of it and hence, will recognize that I have enlarged its domain.
\stopblockquote
In \booktitle{Mécanique Analytique}, Lagrange used his powerful mathematical analysis to expand the equations for Newton's forces into a procedure for analyzing any mechanical system, described using any coordinates. Starting with only the formulas for the system's total kinetic energy and total potential energy, Lagrange's \quotation{regular and uniform procedure} produces a complete set of equations of motion for the system. (Lagrange's equations of motion are a bit more tangled than our position and momentum update formulas, so we will not learn the details of his procedure.)

Lagrange's \booktitle{Mécanique Analytique} was a stunning achievement, unlike anything physics had seen before. Lagrange was viewed as a hero in France under King Louis \convertnumber{KR}{16}. Luckily, his fame transcended the turbulent – often violent – politics of France following the French Revolution in 1789. As governments rose and fell around him, Lagrange continued to play a leading role in the advancement of science and mathematics in France.

\section{Circular, centered orbits}


\startbuffer[U3D]
\startaxis[
 	  %axis line shift=1cm,
	   %axis lines*=left,
   hide x axis,
    hide y axis,
    hide z axis,
        axis lines=center,
        axis on top,
	 view={0}{45},
        width = 7cm,
    %z post scale = {1},
        clip mode = individual,
]
%    \addplot3 [
%        mesh, color = middlegray,
%        z buffer=sort,
%        samples=9,
%        domain=0.1:1,
%        y domain=0:2*pi,
%](
%{x * cos(deg(y))}, {x * sin(deg(y))}, {-10}
%    );
    \addplot3 [
        surf, faceted color = middlegray, color = gray,
        z buffer=sort,
        samples=6,
        domain=2.5:15,
        y domain=0:2*pi,
        samples y=25,
](
{x * cos(deg(y))}, {x * sin(deg(y))}, {-13.27/x}
    );
    \node at (-8,-6,-2.5) {$U$};
    \draw[->] (0,0,0) --node[below, pos = 0.98]{$r$} (16,0,0);
    \draw[shade, ball color = white] (0,0,0) circle[radius=.6mm]node[above=0.8mm] {\Sun};
    \draw[shade, ball color = darkgray] (0.5546,0,0) circle[radius=0.2mm]node[below] {\Mercury};
    \draw[shade, ball color = darkgray] (1.082,0,0) circle[radius=0.3mm]node[above] {\Venus};
    %\draw[] (1.5,0,0) -- (1.5,0,-8.874);
    \draw[shade, ball color = darkgray] (1.496,0,0) circle[radius=0.3mm]node[below=0.4mm] {\Earth};
    \draw[shade, ball color = darkgray] (2.259,0,0) circle[radius=0.25mm]node[above=0.7mm] {\Mars};
    \draw[shade, ball color = darkgray] (7.76,0,0) circle[radius=0.4mm]node[above] {\Jupiter};
    \draw[shade, ball color = darkgray] (14.23,0,0) circle[radius=0.4mm]node[above] {\Saturn};
\stopaxis
\stopbuffer

\marginTikZ{}{U3D}{A planet's gravitational potential energy depends on its distance $r$ from the Sun. A planet released from rest would accelerate toward lower potential energy, crashing into the Sun!} % vskip, name, caption

This three dimensional energy graph will allow us to understand the planets' two dimensional orbits. The vertical axis in our energy graph is energy, as usual. \in{Figure}[fig:U3D] shows the planets' gravitational potential energy, which is very negative near the Sun and rises toward zero far away.
\startformula
	U = -G\frac{mM}{r}
\stopformula
We will use $m$ for the mass of a planet and $M$ for the much larger mass of the Sun.

\startbuffer[KeplerVenus]
\environment env_physics
\environment env_TikZ
\setupbodyfont [libertinus,11pt]
\setoldstyle % Old style numerals in text
\startTEXpage\small
\starttikzpicture% tikz code
\startpolaraxis
 [	xticklabels=\empty,
 	ytick={0,0.5,...,1.5},
 	yticklabels={{},{},$100\units{Gm}$,{}},
 	minor y tick num={1},
	% yminorgrids=true,
	hide x axis,
	ymax = 1.5,
	scale only axis=true, width={5.5cm},
 	tick style={middlegray}, % Fixes ticks which are too light in ConTeXt
	major grid style = {middlegray},
 	% ylabel={Distance from Sun $r$ ($\sci{9}\units{m}$)},
 ]
    \addplot [ % Venus
        thick,
        domain=0:360,
        samples=600,
    ]
        {1.082/(1+0.00676*cos(x-131.77))}
  [yshift=-1.3pt]
    node[pos=0.25] {\Venus}
    ;
	\node [name path=Sun] at (0,0) {\Sun}node[below=1mm]{Sun};
	\draw[->]  (22.5, 1.082) --node[right, pos=.7]{$p$} ({22.5+21}, {13*1.082/12});
	\draw[->]  (22.5, 1.082) --node[above, pos=.7]{$F$} (22.5, {0.7});
	\draw[->]  (67.5, 1.082) -- ({67.5+21}, {13*1.082/12});
	\draw[->]  (67.5, 1.082) -- (67.5, {0.7});
	\draw[->]  (112.5, 1.082) -- ({112.5+21}, {13*1.082/12});
	\draw[->]  (112.5, 1.082) -- (112.5, {0.7});
	\draw[->]  (157.5, 1.082) -- ({157.5+21}, {13*1.082/12});
	\draw[->]  (157.5, 1.082) -- (157.5, {0.7});
	\draw[->]  (202.5, 1.082) -- ({202.5+21}, {13*1.082/12});
	\draw[->]  (202.5, 1.082) -- (202.5, {0.7});
	\draw[->]  (247.5, 1.082) -- ({247.5+21}, {13*1.082/12});
	\draw[->]  (247.5, 1.082) -- (247.5, {0.7});
	\draw[->]  (292.5, 1.082) -- ({292.5+21}, {13*1.082/12});
	\draw[->]  (292.5, 1.082) -- (292.5, {0.7});
	\draw[->]  (337.5, 1.082) -- ({337.5+21}, {13*1.082/12});
	\draw[->]  (337.5, 1.082) -- (337.5, {0.7});
\stoppolaraxis
\stoptikzpicture
\stopTEXpage
\stopbuffer


\marginTikZ{\vskip 6in}{KeplerVenus}{Venus' orbit is an almost perfectly centered circle, making uniform circular motion a good approximation of for Venus. (A gigameter is one billion meters: $1\units{Gm} = 10^9\units{m}$).} % vskip, name, caption

\noindent
A planet following a circular orbit with the Sun at the center moves with uniform circular motion. Venus is shown as an example in \in{figure}[fig:KeplerVenus].
Although uniform circular motion was considered natural in Kepler's time, Descartes and Newton taught us that circular motion requires a central force to bend the planet's path into an orbit.
The force required depends on the planet's momentum $p$ and angular velocity $\omega$, as given by the centripetal force formula (\at{p.}[eq:centripetalforce])
\startformula
	F = \omega p
\stopformula
Using $p = mv$ and $v = \omega r$ for circular motion, we find.
\startformula
	F = m\omega^2 r
\stopformula
The centripetal force formula gives the force required to produce the circular motion, but does not tell us the source of that force. For orbits in the solar system this force is the gravitational force exerted by the Sun, the force directed towards lower gravitational potential energy in \in{figure}[fig:U3D]. The strength of the gravitational force is given by Newton's universal law of gravitation (\at{p.}[eq:UniversalGrav]).
\startformula
	F %= -\pp{r} U
		%= -\pp{r} \left(-G\frac{mM}{r}\right)
		%= GmM \pp{r} \left(r^{-1}\right)
		%= GmM \left(-1r^{-2}\right)
		= -G\frac{mM}{r^2}
\stopformula
The \emph{magnitude} of this gravitational force is the centripetal force above, allowing us to find the planet's angular velocity.
\startformula\startmathalignment\pagereference[eq:AngularVelocityCircular]
\NC	\cancel{m}\omega^2 r	\NC = G\frac{\cancel{m}M}{r^2}	\NR
\NC	\omega				\NC = \sqrt{\frac{GM}{r^3}}	\NR
\stopmathalignment\stopformula
The planet's distance determines its angular velocity, with much higher angular velocities closer to the Sun. Higher angular velocities give shorter periods, which we find using $T = 2\pi / \omega$.
\startformula
	T = \textfrac{2\pi}{\sqrt{GM}}\,r^{\threehalves}
\stopformula
Mercury's orbit takes only 88 days. Venus's orbit is 225 days. Earth's orbit is 365 days. Mars's orbit is 687 days. The outer planets' orbits are far longer – nearly twelve years for Jupiter's orbit and almost thirty years for Saturn's.
The planet's mass has no effect on its angular velocity. % The Sun's strong gravitational pull on these inner planets bends their paths into small, fast orbits.

Using the orbit radii from \in{figure}[fig:VisiblePlanets], you can calculate these periods, and you will get good results.

A centered, circular orbit has only one parameter: its radius $r$. The planet's angular momentum and total energy are directly related to this radius of the other constants ($G$, $M$, and $m$) are known. The angular momentum can be found from the angular velocity $\omega$.
\startformula
	p_\theta = I\omega
\stopformula
This is the angular version of Newton's momentum formula, $p=mv$. (This angular version comes from the $\theta$ update formula.)
We use the angular velocity for circular orbit's (\at{p.}[eq:AngularVelocityCircular]).
\startformula
	p_\theta = mr^2\sqrt{\frac{GM}{r^3}} = m\sqrt{GMr}
\stopformula
Circular orbits with a larger radius $r$ have a greater angular angular momentum $p_\theta$.

The planet's total energy can be found using the angular momentum. ($K_r$ is zero for circular orbits.)
\startformula\startmathalignment
\NC H	\NC = \cancel{K_r} + K_\theta + U			\NR
\NC		\NC = \frac{p_\theta^2}{2I} - G\frac{mM}{r}	\NR
\NC		\NC = \frac{m^2 GMr}{2mr^2} - G\frac{mM}{r}	\NR
\NC		\NC = G\frac{mM}{2r} - G\frac{mM}{r}		\NR
\NC		\NC = -G\frac{mM}{2r}						\NR
\stopmathalignment\stopformula
The total energy of a circular orbit is negative, and exactly half of the gravitational potential energy. 
Circular orbits with a larger radius $r$ have a higher (less negative) total energy $H$.

\startuseMPgraphic{graph::CircularH} % I'd like to add minor ticks, 0.667mm long.
vardef U =
	path p;
		for x = 0.5 step 0.1 until 3.1:
			y := -13.3/x; % lua.mp.morse(x);
			augment.p(x,y);
		endfor;
	p enddef;
vardef H =
	path p;
		for x = 0.2 step 0.1 until 3.1:
			y := -13.3/(2x); % lua.mp.morse(x);
			augment.p(x,y);
		endfor;
	p enddef;
draw begingraph(4cm,5cm);
	setrange(0,-20, 3, 0);
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("Energy per mass ($\sci{8}\units{J/kg}$)") rotated 90,OUT);
	glabel.bot(textext("Distance from Sun $r$ ($\sci{11}\units{m}$)"), OUT);
	gdraw(U) withpen pencircle scaled 0.8pt;
	glabel.lrt("$U$",10);
	gdraw(H) withpen pencircle scaled 1pt dashed withdots;
	glabel.ulft("$H$",10);
%	glabel(mydot,(80));
%	glabel(mydot,(210));
%	glabel(mydot,(340));
%	gfill(unitsquare xyscaled (6.37,-2)) withcolor "lightgray";
%	gdraw((6.37,0) -- (6.37,-2)) withpen pencircle scaled 0.8pt;
	for y=0 step -2 until -20:%auto.y:
		itick.lft(formatted("$@g$", y), y);
		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
	endfor
endgraph shifted (0,-5cm);
%  pickup pencircle scaled 0.8pt ;
%  draw externalfigure "EarthEratosthenes.png" scaled 0.127 shifted (-6.37mm,-6.37mm) ;
%  draw fullcircle scaled 12.74mm;
%  drawarrow (13mm,0) -- (-0.5mm,0);
%    dotlabel.ulft  ("", (13mm,0)) ;
%  drawarrow (26mm,0) -- (22.625mm,0);
%    dotlabel.top  ("$F\sub{Newton}$", (26mm,0)) ;
%  drawarrow (39mm,0) -- (37.5mm,0);
%    dotlabel.llft  ("", (39mm,0)) ;
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:CircularH, title={A planet's total energy $H$ in a circular, centered orbit is exactly half of the planet's gravitational potential energy $U$.}]
\small\reuseMPgraphic{graph::CircularH}
\stopplacefigure

The energy graph in \in{figure}[fig:CircularH] shows the gravitational potential energy and a dotted line at $-GMm/2r$. Each dot represents the total energy of a possible circular orbit. Dots toward the upper right represent larger orbits with greater angular momentum and higher energy. Dots toward the lower left represent smaller orbits with less angular momentum and lower energy.




\section{Friction and other external forces}

Daniel Bernoulli taught us to include potential energy in our system whenever possible. We included gravitational potential energy in the pendulum system, rather than calculating the work done by gravity. We included spring potential energy in our simple harmonic oscillator rather than calculating the work done by the spring. Unfortunately, some forces cannot be represented by a potential energy. In these cases we must leave the force as external, doing work on the system.

Friction is one of these external forces. 
Sliding a block on a table requires some work due to the friction between the block and the table. The work done sliding the block is not stored as potential energy. Instead, the work contributes to random, microscopic motion in the surface of the block and the table. (The sliding sound you hear is some of that random motion.)
Until we study heat, we will always leave this random, microscopic motion out of our systems. That means friction will always be an external force doing work on the system – usually negative work, reducing the system's energy.

\startbuffer[SpringBlockClean]
	\fill [black!10] (-.23,0) rectangle (4.8,-.15);
	\fill [black!10] (0,0) rectangle (-.23,.6);
	\draw[thin] (0,0) -- (0,.6);
	\startaxis[margin cart track,
			xmin=-24,xmax=24,
			ymax=10,
			xlabel={},
			]
	\path (-15,0) pic {block}node[above = 5mm]{$m$};
	\draw[decorate,decoration={coil,segment length=1.06pt}] (-24,2.5) --node[above=3pt] {$k$} (-18,2.5);
    \stopaxis
\stopbuffer

\startuseMPgraphic{graph::BlockSHOGraphs} % I'd like to add minor ticks, 0.667mm long.
	path U, H, K, Re, Turn, Stop; %TPA, TPB, TPC, TPD, TPE, TPF, St;
	U := (-24,24) ..controls (-8,-8) and (8,-8).. (24,24);
	%H := (-15,75/8) -- (12,6) -- (-9,27/8) -- (6,1.5) -- (-3,3/8) -- (0,0);
	%H := (-15,75/8) -- (13,169/24) -- (-11,121/24) -- (9,27/8) -- (-7,49/24) --(5,25/24) --(-3, 3/8) -- (1,1/24);
	H := (-15,75/8) -- (9,27/8) -- (-3, 3/8);
	%H := (-15,75/8) -- (11,121/24) -- (-7,49/24) --(3, 3/8) -- (1,1/24);
	%H := (-15,75/8) -- (-3,3/8) ;
	K := (-24,-18) ..controls (-8,14) and (8,14).. (24,-18);
	Re := (-15,0) -- (-15,13);
	%TPA := (13,0) -- (13,13);
	%TPA := (11,0) -- (11,13);
	Turn := (9,0) -- (9,13);
	%TPB := (-7,0) -- (-7,13);
	%TPE := (5,0) -- (5,13);
	Stop := (-3,0) -- (-3,13);
	%Stop := (1,0) -- (1,13);
draw begingraph(4.5cm,2.4cm);
	setrange(-21,0, 24, 24);
	itick.lft(formatted("$@g$", 0), 0);
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("Energy") rotated 90,OUT)  shifted (2mm,0);
	glabel.bot(textext("$x$ (cm)"), OUT);
	gdraw(Re) withcolor "middlegray";
	glabel.rt("release",1) rotatedaround(point 0.97 of Re, 90);
	gdraw(Turn) withcolor "middlegray";
	glabel.rt("turn",1) rotatedaround(point 0.97 of Turn, 90);
%	gdraw(TPB) withcolor "middlegray";
%	glabel.rt("turn 2",1) rotatedaround(point 0.97 of TPB, 90);
%	gdraw(TPC) withcolor "middlegray";
%	glabel.rt("turn 3",.92) rotatedaround(point 0.97 of TPC, 90);
%	gdraw(TPD) withcolor "middlegray";
%	glabel.rt("turn 4",1) rotatedaround(point 0.97 of TPD, 90);
%	gdraw(TPE) withcolor "middlegray";
%	glabel.rt("turn 5",1) rotatedaround(point 0.97 of TPE, 90);
%	gdraw(TPF) withcolor "middlegray";
%	glabel.rt("turn 6",1) rotatedaround(point 0.97 of TPF, 90);
	gdraw(Stop) withcolor "middlegray";
	glabel.rt("stop",.97) rotatedaround(point 0.97 of Stop, 90);
	gdraw(U) withpen pencircle scaled 0.8pt;
	glabel.llft("$U$",0.17);
	gdraw(H) withpen pencircle scaled 0.8pt;
	glabel.top("$H$",0.36);
endgraph;
%	path p;
%	p := (8,0) ..controls (8,0.66) and (7.33,1.33).. (6,2)
%		-- (1,4.5) ..controls (0.33,4.83) and (0,5.17).. (0,5.5);
%	picture myarrow;
%	myarrow := image(
%		drawarrow (-2mm,0) -- origin withpen pencircle scaled 0.8pt;
%	);
	vardef position =
		path p;
		for t = 0 upto 8*3.14:
			x := -12*cos(t/8) - 3; augment.p(x,t); endfor;
		for t = 8*3.14 upto 16*3.14:
			x := -6*cos(t/8) + 3; augment.p(x,t); endfor;
		augment.p(-3,160);
		p enddef;
	path xmax, xmin, equlib ;
	xmax := (9,0) -- (9,8*3.14);
	xmin := (-3,0) -- (-3,16*3.14);
	equlib := (0,6) -- (0,160);
draw begingraph(4.5cm,5cm);
	setcoords(linear, -linear);
	setrange(-21,0, 24,80);
%	for y=auto.y:
	itick.lft(formatted("$@g$", 0), 0);
%		itick.lft(formatted("$@g$", y), y);
%		itick.lft(formatted("@s", ""), y) withcolor "middlegray";
%		itick.rt(formatted("@s", ""), y) withcolor "middlegray";
%	endfor
	for x=auto.x:
		%itick.top(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("$t$"),OUT) shifted (2mm,0);
	%glabel.top(textext("$x$ (m)"), OUT);
	gdraw(xmin) withcolor "middlegray";
	%glabel.top("turning",0.72);% rotatedaround(point 0.72 of TPL, 90);
	%glabel.bot("point",0.72) rotatedaround(point 0.72 of TPL, 90);
	gdraw(xmax) withcolor "middlegray";
	%glabel.top("turning",0.72) rotatedaround(point 0.72 of TPR, 90);
	%glabel.bot("point",0.72) rotatedaround(point 0.72 of TPR, 90);
	gdraw(equlib) withcolor "middlegray";
	%gdrawdblarrow (0,8*3.14) -- (12,8*3.14);
	%glabel.top("$A$",0.4) ;
%	gdraw (12,8*3.14) -- (16,8*3.14) withcolor "middlegray";
%	gdraw (12,24*3.14) -- (16,24*3.14) withcolor "middlegray";
%	gdrawdblarrow (15,8*3.14) -- (15,24*3.14);
%	glabel.rt("$T$",0.5) ;
	gdraw(position) withpen pencircle scaled 0.8pt;
endgraph shifted (0cm, -5.4cm);
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:BlockSHOGraphs, title={The block at its release position (top), the energy graph for the block and spring (middle), and the block's position vs.\ time graph (bottom). The block's kinetic energy $K$ is not shown.}]
\typesetbuffer[starttikz,SpringBlockClean,stoptikz]\small
\reuseMPgraphic{graph::BlockSHOGraphs}
\stopplacefigure

\startbuffer[SpringBlockCleanRight]
	\fill [black!10] (-.23,0) rectangle (4.8,-.15);
	\fill [black!10] (0,0) rectangle (-.23,.6);
	\draw[thin] (0,0) -- (0,.6);
	\startaxis[margin cart track,
			xmin=-24,xmax=24,
			ymax=10,
			xlabel={},
			clip = false,
			hide x axis = true,
			]
	\draw[] (-24,0) -- (24,0);
	\path (-4,0) pic {block}[opacity=.4];
	\path (4,0) pic {block};
	\draw[decorate,decoration={coil,segment length=5pt}] (-24,2.5) -- (1,2.5);
	\draw[-{Straight Barb}, thick] (-4,2.5) --node[above=2mm] {$dx$} (4,2.5);
	\draw[->, very thick] (4,0) --node[below, pos=0.4] {$F$} (-0.5,0);
    \stopaxis
\stopbuffer

\startuseMPgraphic{graph::SlideRight} % I'd like to add minor ticks, 0.667mm long.
	path U, H;
	%U := (-16,24) -- (-15,75/8) ..controls (-5,-25/8) and (5,-25/8).. (15,75/8) -- (16,0);
	H := (-12,14) -- (12,8);
draw begingraph(4.5cm,2.4cm);
	setrange(-21,0, 24, 24);
	autogrid(,);
	glabel.lft(textext("Energy") rotated 90,OUT);
	glabel.bot(textext("$x$"), OUT);
	gdrawarrow(H) withpen pencircle scaled 0.8pt;
	glabel.bot("$H$",0.2);
	gdrawarrow (-4,12) -- (4,12) withpen pencircle scaled 0.8pt;
	glabel.top("$dx$",0.5);
	gdrawarrow (4,12) -- (4,10) withpen pencircle scaled 0.8pt;
	glabel.rt("$dH$",0);
endgraph;
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:SlideRight, title={As the block slides a small distance $dx$ to the right, friction reduces the total energy by $dH$.}]
\typesetbuffer[starttikz,SpringBlockCleanRight,stoptikz]\small
\reuseMPgraphic{graph::SlideRight}
\stopplacefigure

\in{Figure}[fig:BlockSHOGraphs] shows the energy reducing effect of friction on our simple harmonic oscillator. The cart has been replaced by a block that slides on the table. As the block slides to the right, friction exerts and opposing force $F$ to the left. This force constantly decreases the system's total energy. While the block travels a short distance $dx$ to the the right (\in{fig.}[fig:SlideRight]), the force $F$ does a small amount of work $W = F\,dx$.
Since the rightward displacement is positive and the leftward force is negative, the work is negative. We can use this work with conservation of energy to find the total energy's small change $dH$.
\startformula\startmathalignment
\NC	H\si + W + \cancel{Q}	\NC = H\sf	\NR
\NC	H\sf - H\si	\NC = W	\NR
\NC	dH	\NC = F\,dx	\NR
\stopmathalignment\stopformula
The total energy's small change $dH$ is negative because the small amount of work $F\,dx$ is negative. This gives the energy graph of $H$ a negative slope, as shown in \in{figure}[fig:SlideRight]. This negative slope is also seen in the energy graph in \in{figure}[fig:BlockSHOGraphs] when the block is sliding to the right from the release point to the first turning point. The negative slope is equal to the negative, leftward force $F$.

The block was released $16\units{cm}$ to the left of the spring's relaxed position at $x=0\units{cm}$, but the loss of energy during the block's rightward slide allows it to only travel $9\units{cm}$ to the right of the spring's relaxed position before the system's total energy $H$ is equal to the potential energy $U$. At this point, the block's kinetic energy is zero. The block stops at this turning point and begins sliding back toward the spring's relaxed position at $x=0\units{cm}$.

\startbuffer[SpringBlockCleanLeft]
	\fill [black!10] (-.23,0) rectangle (4.8,-.15);
	\fill [black!10] (0,0) rectangle (-.23,.6);
	\draw[thin] (0,0) -- (0,.6);
	\startaxis[margin cart track,
			xmin=-24,xmax=24,
			ymax=10,
			xlabel={},
			clip = false,
			hide x axis = true,
			]
	\draw[] (-24,0) -- (24,0);
	\path (4,0) pic {block}[opacity=.4];
	\path (-4,0) pic {block};
	\draw[decorate,decoration={coil,segment length=3.3pt}] (-24,2.5) -- (-7,2.5);
	\draw[-{Straight Barb}, thick] (4,2.5) --node[above=2mm] {$dx$} (-4,2.5);
	\draw[->, very thick] (-4,0) --node[below, pos=0.4] {$F$} (0.5,0);
    \stopaxis
\stopbuffer

\startuseMPgraphic{graph::SlideLeft} % I'd like to add minor ticks, 0.667mm long.
	path U, H;
	%U := (-16,24) -- (-15,75/8) ..controls (-5,-25/8) and (5,-25/8).. (15,75/8) -- (16,0);
	H := (12,14) -- (-12,8);
draw begingraph(4.5cm,2.4cm);
	setrange(-21,0, 24, 24);
	autogrid(,);
	glabel.lft(textext("Energy") rotated 90,OUT);
	glabel.bot(textext("$x$"), OUT);
	gdrawarrow(H) withpen pencircle scaled 0.8pt;
	glabel.bot("$H$",0.2);
	gdrawarrow (4,12) -- (-4,12) withpen pencircle scaled 0.8pt;
	glabel.top("$dx$",0.5);
	gdrawarrow (-4,12) -- (-4,10) withpen pencircle scaled 0.8pt;
	glabel.lft("$dH$",0);
endgraph;
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:SlideLeft, title={As the block slides a small distance $dx$ to the left, friction reduces the total energy by $dH$.}]
\typesetbuffer[starttikz,SpringBlockCleanLeft,stoptikz]\small
\reuseMPgraphic{graph::SlideLeft}
\stopplacefigure

After the turning point, when the block is sliding back toward the left, the opposing force of friction is to the right (\in{fig.}[fig:SlideLeft]). 
While the block slides a small negative distance $dx$, the positive force $F$ does a small amount of negative work $F\,dx$, decreasing the total energy by the small amount $dH = F\,dx$, as shown in \in{figure}[fig:SlideLeft]. The energy graph of the total energy $H$ has a positive slope, even though the energy is decreasing due to the block's motion in the negative direction. This positive slope is seen in \in{figure}[fig:SlideLeft] and also in the energy graph in \in{figure}[fig:BlockSHOGraphs] when the block is sliding to the left from the turning point to the point where the block stops. The positive slope of these graphs is equal to the positive, rightward force $F$.

Any outside force can do work on the system. We first saw this in \in{examples}[ex:CartWork1] and \in[ex:CartWork2] (\at{pp.}[ex:CartWork1]-\at[CartWorkEnding]), when you were pushing the book cart down the hallway. In those examples, you did positive work to increase the cart's total energy, getting the cart moving. Then, you did negative work to decrease the cart's total energy, brining it to a stop. The positive work you do comes from chemical potential energy stored in the foods you eat. The negative work you do goes to microscopic, random motion in your muscles. In either case, we do not want to include the complicated chemical potential energy or microscopic, random energy in our system. Instead, we leave these out of the system and treat your force as an external force doing work on the system.

We follow Daniel Bernoulli's advice by putting potential energy in our system whenever we can. But when we cannot, we leave the energy outside of our system, allowing it to act as an external force doing work on the system. We still use the energy graph to understand the motion, with the external force determining the slope of the total energy $H$.

Let us finish the story of the block, which was sliding to the left, losing energy due to the opposing force of friction.
\in{Figure}[fig:BlockSHOGraphs] shows the block moving to the left after the turn.   
When it arrives at $x=-3\units{cm}$, the system's total energy $H$ is again equal to the potential energy $U$, as shown in \in{figure}[fig:SlideToStop]. The block cannot continue to the left because the system's total energy would be less than its potential energy, which is impossible. This prohibited, leftward motion is shown by the dotted, \quotation{no} line sloping down and to the left in \in{figure}[fig:SlideToStop]. The block also cannot turn and move to the right because that would also lead to the system's total energy being less than its potential energy. This prohibited, rightward motion is shown by the dotted, \quotation{no} line sloping down and to the right in \in{figure}[fig:SlideToStop].
Unable to move in either direction, the block remains stopped at $x=-3\units{cm}$. This is shown as the stopping point in \in{figure}[fig:BlockSHOGraphs].

\startbuffer[SpringBlockCleanStop]
	\fill [black!10] (-.23,0) rectangle (4.8,-.15);
	\fill [black!10] (0,0) rectangle (-.23,.6);
	\draw[thin] (0,0) -- (0,.6);
	\startaxis[margin cart track,
			xmin=-24,xmax=24,
			ymax=10,
			xlabel={},
			clip = false,
			hide x axis = true,
			]
	\draw[] (-24,0) -- (24,0);
	\path (-3,0) pic {block};
	\draw[decorate,decoration={coil,segment length=3.6pt}] (-24,2.5) -- (-6,2.5);
	\draw[->, very thick] (-3,0) --node[below, pos=0.4] {$F$} (-7.5,0);
    \stopaxis
\stopbuffer

\startuseMPgraphic{graph::SlideToStop} % I'd like to add minor ticks, 0.667mm long.
	path U, H, nope;
	U := (-15,75/8) ..controls (-5,-25/8) and (5,-25/8).. (15,75/8);
	H := (-1.5,3/4) -- (-3, 3/8);
	nope := (-4.5,0) -- (-3, 3/8) -- (-1.5,0);
draw begingraph(4.5cm,2.4cm);
	setrange(-4,0, -2, 1.33);
	itick.lft(formatted("$@g$", 0), 0);
	for x=auto.x:
		itick.bot(formatted("$@g$", x), x);
		itick.bot(formatted("@s", ""), x) withcolor "middlegray";
		itick.top(formatted("@s", ""), x) withcolor "middlegray";
	endfor
	glabel.lft(textext("Energy") rotated 90,OUT) shifted (2mm,0);
	glabel.bot(textext("$x$ (cm)"), OUT);
	gdraw(U) withpen pencircle scaled 0.8pt;
	glabel.top("$U$",0.38);
	gdrawarrow(H) withpen pencircle scaled 0.8pt;
	glabel.top("$H$",0.7);
	gdraw(nope) withpen pencircle scaled 1.2pt dashed withdots;
	glabel.bot("no",1.25);
	glabel.bot("no",0.75);
	glabel(mydot,1);
%	gdrawarrow (-3.25,0.44) -- (-2.75,0.44) withpen pencircle scaled 0.8pt;
%	glabel.top("$\partial x$",0.5);
%	gdrawarrow (-2.75,0.44) -- (-2.75,0.315) withpen pencircle scaled 0.8pt;
%	glabel.rt("$\partial U$",0);
endgraph;
\stopuseMPgraphic

\startplacefigure[location=margin, reference=fig:SlideToStop, title={The block stops at $x=-3\units{cm}$, unable to move in either direction. Notice the greatly enlarged scale on the energy graph, zooming in to the region around $x=-3\units{cm}$.}]
\typesetbuffer[starttikz,SpringBlockCleanStop,stoptikz]\small
\reuseMPgraphic{graph::SlideToStop}
\stopplacefigure


\section{Hamilton's canonical equations of motion}

While physics advanced on the continent, the situation in England was dire. English physicists were ignoring the industrial revolution transforming their civilization, and ignoring the French mathematical revolution transforming physics.
They remained paralyzed by a fanatic devotion to Newton’s cumbersome, geometric methods and continued to hold a grudge over the Leibniz’s calculus and \visviva. This problem persisted until 1812, when a group of young undergraduate students at Cambridge started the Analytical Society, partly as a joke, to study the methods of French analysis. They learned to solve problems using the continental notation and even translated a few important French books and papers into English. The club met for a few years and essentially disappeared after its members graduated and left Cambridge in 1817.

That probably would have been the end of this little revolt, except that one of the members, George Peacock, was appointed in 1817 to write questions for the rigorous Mathematical Tripos exam taken by all third year mathematics students at Cambridge. He audaciously wrote his questions using the continental notation. This caused a bit of grumbling among the faculty, but they did not interfere. Surprisingly, Peacock was asked to write questions again in 1819. Students recognized this as a complete surrender by the Newtonian faculty. From there, the adoption of continental notation and methods in England was quite swift. Newton remained a revered figure, but his 150 year old dispute with Leibniz was finally laid to rest. %Cannell p. 38

The United Kingdom began producing great physicists. Among the first was William Rowan Hamilton. Hamilton was a genius, gifted in languages and mathematics. He learned Hebrew, Latin, and Greek from early childhood. At the age of 15 he read Newton’s \booktitle{Principia}, and a two years later the great French work \booktitle{M\'echanique C\'eleste}, by Pierre-Simon Laplace.%Cannell p. 39

In 1823, at the age of 18, Hamilton entered Trinity College Dublin.
Trinity College had adopted the continental notation in 1812, a bit ahead of Cambridge, and used the French textbooks in mathematics and physics courses. Hamilton embraced the abstract approach. He earned top marks in all of his courses and won many awards, which propelled him to a position as head of the Dunsink Observatory, near Dublin. Although the observatory provided ample opportunity for practical astronomy, Hamilton continued to focus on more theoretical interests, first in optics and then in mechanics.

Hamilton wrote two groundbreaking papers on mechanics, \booktitle{On A General Method In Dynamics} in 1834 and \booktitle{Second Essay On A General Method In Dynamics} in 1835. Hamilton's general method produces the equations of motion for any problem in mechanics, just like Lagrange's procedure, but Hamilton's general method is much easier to understand and execute.
We will study Hamilton's general method in this chapter. First, we will learn to produce equations of motion from a system's total energy formula. Then, we will learn some methods of solving these equations of motion in specific examples. In \in{Chapter}[ch:Rotation], Hamilton's general method will explain the compound motions of planets. In \in{Chapter}[ch:Waves], it will reveal the compound vibrations of a musical string.

Hamilton's general method brings together the big ideas of position, momentum, and energy in a surprisingly simple way. Hamilton found that he did not need two separate formulas for kinetic energy and potential energy, one formula for the total energy is enough. (He chose the symbol $H$ for total energy, which we have adopted.) Hamilton also recognized momentum's importance, and used momentum in his formula for total energy. For example, to describe the cart-on-a-spring system in \in{figure}[fig:HamiltonSpringCart], Hamilton would write the total energy
\startbuffer[HamiltonSpringCart]
	\fill [black!10] (-.23,0) rectangle (4.8,-.15);
	\fill [black!10] (0,0) rectangle (-.23,.6);
	\draw[thin] (0,0) -- (0,.6);
	\startaxis[margin cart track,
			xmin=-24,xmax=24,
			ymax=10,
			]
	\path (0,0) pic {cart}node[above = 5mm]{$m$};
	\draw[decorate,decoration={coil,segment length=3.6pt}] (-24,2.5) --node[above=3pt] {$k$} (-6,2.5);
    \stopaxis
\stopbuffer

\marginTikZ{}{HamiltonSpringCart}{A cart connected to an ideal spring.} % vskip, name, caption
\startformula
  H = \textfrac{1}{2m}p^2 + \textfrac{k}{2}x^2. %\frac{p^2}{2m} + \half kx^2
\stopformula
The coefficients $1/2m$ and $k/2$ are constants. The dynamical variables $p$ and $x$ describe the system's changing momentum and position.
Euler and Lagrange used velocity rather than momentum, writing kinetic energy as $K=\onehalf mv^2$. Using velocity is reasonable, but it caused the update formulas to get tangled. Hamilton discovered that using momentum allowed him to separate the update formulas, making the equations of motion much easier to understand and solve. When a system's total energy is written in Hamilton's form, with positions and momenta, it is called the system's \keyterm{Hamiltonian}.

%\section{Hamilton's momentum update formula}

%Hamilton's momentum update formula uses and idea similar to Lagrange's equation, 

Hamilton followed Daniel Bernoulli's advice and described all interactions as potential energy, not Newtonian forces. There is a bit of an obstacle to this approach. Lagrange's equation tells us how to convert to Newton's force from potential energy, but it does not tell us how to convert the other way. In fact, some forces (like friction) cannot be described using potential energy and must be left as outside forces acting on the system. We will use $F$ only for these external forces. Any interaction that can be described using potential energy will be included in the energy formula.

The system's total energy $H$ and the external force $F$ come together in Hamilton's momentum update formula.
\startformula[eq:Hamilton2]
	dp = \left(-\ppx H + F \right) dt
\stopformula
Parts of this new formula should be reassuringly familiar. For a system with only external forces (no energy) this is Newton's momentum update formula, $dp = F\,dt$. The new term on the right looks almost identical to Lagrange's equation, $F\sub{Newton} = -\partial U/\partial x$, but Hamilton replaces the potential energy $U$ with the total energy $H$. This replacement will be essential when using curved coordinates, like the polar coordinate used to describe orbits.%, but it has no effect in most of the systems we have studied.

To see Hamilton's procedure in action, let us find the momentum update formula for the familiar cart-on-a-spring system. First, put the system's Hamiltonian into Hamilton's momentum update formula. The spring is included in the system, so there are no external forces.
\startformula
	dp = \left( -\ppx H + \cancel{F} \right) dt
		%= -\ppx H dt
		= -\ppx \left( \textfrac{1}{2m}p^2 + \textfrac{k}{2}x^2 \right) dt
\stopformula
Use the sum rule and then the coefficient rule to pull the coefficients out of the partial derivatives.
\startformula\startmathalignment
\NC	dp	\NC = -\left( \ppx  \textfrac{1}{2m}p^2 + \ppx\textfrac{k}{2}x^2 \right) dt		\NR
\NC		\NC = -\left( \textfrac{1}{2m} \ppx p^2 + \textfrac{k}{2} \ppx x^2 \right) dt	\NR
\stopmathalignment\stopformula
When calculating the partial derivative $\partial/\partial x$, the variable $p$ is constant. Therefore, the constant rule for derivatives tells us that the first term in parenthesis is zero. The second term is found using the power rule with $n=2$.
\startformula
	dp = -\left( 0 + \textfrac{k}{2} 2x^{(2-1)} \right) dt
		= - kx\,dt
\stopformula
This is the correct position update formula that we found before using Hooke's law. 

Hamilton found that the total energy $H$ also produces the position update formula. 
\startformula
	dx = \pp{p} H\,dt
\stopformula
This formula is not familiar, but with your new derivative skills it will be easy to use.
\startexample[ex:CannonDirivaties]
Use Hamilton's position update formula to find the position update formula for the cart-on-a-spring system in \in{figure}[fig:HamiltonSpringCart].
\startsolution
Put the cart-on-a-spring Hamiltonian into Hamilton's position update formula. Then use derivative rules to pull the coefficients out of the partial derivatives.
\startformula
	dx = \pp{p} H\,dt
		= \pp{p} \left( \textfrac{1}{2m}p^2 + \textfrac{k}{2}x^2 \right) dt
		= \left( \textfrac{1}{2m} \pp{p} p^2 +\textfrac{k}{2}\pp{p}x^2 \right) dt
\stopformula
When calculating the partial derivative $\partial/\partial p$, the variable $x$ is constant. Therefore, the constant rule for derivatives tells us that the second term in parenthesis is zero. The first term is found using the power rule with $n=2$.
\startformula
	dx = \left( \textfrac{1}{2m} 2 p^{(2-1)} +0 \right) dt
		= \textfrac{1}{m} p\,dt
\stopformula
This is the familiar position update formula $dx = v\,dt$ with the velocity $v = p/m$.
\stopsolution
\stopexample

Hamilton's general method produces the complete equations of motion for any mechanical system from the system's Hamiltonian – the system's total energy written in terms of the positions and momenta. Hamilton's method is a favorite with physicists because of its power, beauty, and practicality. The method is also excellent for students. Writing the Hamiltonian is often fairly easy, even for complicated systems; the method often requires only basic skills with derivatives; and the equations of motion are separated into their most useful form. Hamilton's method is not necessary for a simple system like the cart on a spring, but it is ideal for our quadrivium problems. 

% Need references in this chapter!
%\subject{Notes}
%\placenotes[endnote][criterium=chapter]
%
%\subject{Bibliography}
%  \placelistofpublications

\stopchapter
\stopcomponent