\startcomponent luagraph-introduction

\environment luagraph-environment

\startchapter [title=Introduction]

\placeinitial
Luatex has brought \TEX\ typesetting into the 21\high{st} Century. By
integrating the \LUA\ scripting language as well as a \METAPOST\
interpreter in the form of a native library, this allows for the
efficient reading of data as well as its manipulation, reduction,
analysis, and finally graphical presentation. There is no need for
\emphasis {external} programs or graphics files, and luatex is so
efficient that quite large datasets can be handled with limitations
often lying with the system used to display or to print the PDF file
that is produced.

\startplacefigure [location={right,high},
                   title={John Hobby's graph macros}]
\externalfigure %[mpgraph] [page=1,width=.5\textwidth]
                %[mpgraph_p1cropped] [width=.5\textwidth]
                 [tb70hobb] [page=1,width=.5\textwidth]
\stopplacefigure

In \cite[year] [Hobby2001], thus at the beginning of this century, John
Hobby, the creator of the \METAPOST\ language (based on Donald Knuth's
\METAFONT\ language), wrote a package for the drawing of data graphs.
\cite[footnote] [Hobby2001] \METAPOST\ was enhanced in 2013 by the introduction of
a double|-|precision number system (as of \METAPOST\ version 1.780). I
then undertook the task of modifying the original \type {graph} package
to take advantage of moving from scaled integer to double|-|precision
floating point calculations, adding a few features such as the drawing
of error bars while I was at it. The formatting of labels was of course
performed by \TEX. This was presented at the \CONTEXT\ meeting in
Brejlov in 2013. I then happily, and only personally it appears, used
this to produce plots of data in my own work.

A limitation remained through the poor input/output model used by
\METAPOST. When, in the course of 2018 I wanted to digest some large
files of data, I found that this was unsatisfactory. Furthermore, it
appeared that my additions (of the handling of error bars, for example)
were the cause of further processing slowdowns. Something had to be
done. Hans Hagen fed me some hints or teasers of \LUA\ code to read in my
data and to pass this to the \METAPOST\ library. This got us to start
playing with efficiencies and testing the performance of differing
approaches sharing calculation or data manipulation tasks between the
\METAPOST\ language and the \LUA\ interpreter. \LUA\ can be blazingly fast,
while \METAPOST\ remains quite efficient for the graphical tasks for
which it was written. My hybrid solution worked reasonably well, but
this got me to start thinking about completely re|-|writing the John
Hobby graph macros from scratch or perhaps creating a \LUA|-|based
interface and the possibility of having \CONTEXT\ macros or commands for
specific tasks. I presented this to the 2018 \CONTEXT\ meeting in
Sib≈ôina, asking for input on how to best go forward.

Lua is a natural space for handling tables of data, as well as for
flexible and efficient calculations and manipulations. It beats, hands
down, other fashionable interpretive languages such as python and even
proves often to be more efficient than compiled C code (even though
\LUA\ was designed to integrate functions written in C for critical tasks, for
our purposes this never seems to yield any gains). \METAPOST, on the
other hand, remains very attractive and advantageous in the creation of
graphics. The version or module presented here remains anchored in
\METAPOST, resorting to \LUA\ code for the handling of data. This can be a
bit schizophrenic, switching syntactically from one environment to
another or in thinking algorithmically in one language to another.

\startplacefigure [location=left,
                   title={luametafun, in the distribution}]
\externalfigure [luametafun] [page=1,width=.28\textwidth]
\stopplacefigure

Further progress was made as we transitioned from the luatex to the
luametatex engines. Luametatex is a \quotation {lean and mean} version
of luatex, from which we stripped all that was unnecessary and otherwise
cleaned up the implementation, in particular removing dependencies on
external library packages as much as possible. This also allows us to
experiment, to add new functionality, in particular a better integration
between \LUA\ and \METAPOST. The result is expanded \METAFUN\ macros
including some specific graphing helpers. What I am doing here is a
little different.

My approach here has been to take the logic behind the Hobby \type {graph}
package and to borrow from its syntax as much as possible, while taking
liberties to deviate some where I believed improvements could be useful.
From there, I then proceeded by freely imagining solutions on how to
best serve this syntax and logic, using none of the original \type
{graph} code whatsoever. Perhaps this was somewhat a mistake, for nobody
masters using \METAPOST\ better than its creator, who often employed
truly ingenious solutions! So be it: my guidance has been a constant
prodding for performance by Hans, who would frequently challenge me with
a \LUA\ code snippet that could be orders of magnitude faster.

We did this partially as using \METAPOST\ is \METAFUN! Additionally, Taco
Hoekwater would occasionally contribute to our discussions, for he too
appreciates the beauty of the \METAPOST\ language. I must also thank
Luigi Scarso for continuing to maintain \METAPOST and standard luatex,
as well as for contributing strategically to our discussions around
problems and their solutions.

\stopchapter

\stopcomponent
